(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28836,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"warnOnce",{enumerable:!0,get:function(){return r}});let r=e=>{}},22941,e=>{"use strict";var a=e.i(83740),t=e.i(33033),r=e.i(5334);let i=(0,t.createContext)(void 0);function n({children:n}){let[o,l]=(0,t.useState)(null),[s,c]=(0,t.useState)(!0),[d,u]=(0,t.useState)(!1),[m,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{let a=(0,r.getSupabaseClient)(),{data:{user:t},error:i}=await a.auth.getUser();if(t&&!i){let a=t.email||"",r=t.user_metadata?.role||"patient",i=a.toLowerCase().endsWith("@gmail.com");if(l({id:t.id,email:a,name:t.user_metadata?.name||a||"",role:r,phone:t.user_metadata?.phone,specialization:t.user_metadata?.specialization}),"patient"===r&&i){u(!1),h(!0);try{let{patientService:r}=await e.A(44514);await r.getByEmail(a)||await r.create({user_id:t.id,name:t.user_metadata?.name||a,email:a,phone:t.user_metadata?.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record for Gmail user:",e)}}}}catch(e){console.error("[v0] Auth initialization error:",e)}c(!1)})()},[]);let p=async(a,t)=>{try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.from("auth_users").select("*").eq("email",a).maybeSingle();if(o&&console.warn("[v0] Supabase error checking auth_users:",o),n)if(n.password_hash===t){let a={id:n.id,email:n.email,name:n.name||n.email,role:n.role,phone:n.phone||void 0,specialization:n.specialization||void 0};l(a),localStorage.setItem("user",JSON.stringify(a));let t=(a.email||"").toLowerCase().endsWith("@gmail.com");if("patient"===a.role)if(t){u(!1),h(!0);try{let{patientService:t}=await e.A(44514);await t.getByEmail(a.email)||await t.create({user_id:a.id,name:a.name||a.email,email:a.email,phone:a.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after login:",e)}}else u(!0),h(!1);return}else throw Error("Invalid credentials")}catch(e){console.warn("[v0] Error authenticating against auth_users:",e)}try{let i=(0,r.getSupabaseClient)(),{data:n,error:o}=await i.auth.signInWithPassword({email:a,password:t});if(o)console.warn("[v0] Supabase auth signIn error:",o);else if(n&&n.user){let t=n.user,r=t.user_metadata?.role||"patient",i={id:t.id,email:t.email||a,name:t.user_metadata?.name||t.email||a,role:r,phone:t.user_metadata?.phone||void 0,specialization:t.user_metadata?.specialization||void 0};if(l(i),localStorage.setItem("user",JSON.stringify(i)),"patient"===i.role){(i.email||"").toLowerCase().endsWith("@gmail.com"),u(!1),h(!0);try{let{patientService:a}=await e.A(44514);await a.getByEmail(i.email)||await a.create({user_id:i.id,name:i.name||i.email,email:i.email,phone:i.phone||null,dob:null,gender:null,address:null})}catch(e){console.warn("[v0] Could not auto-create patient record after supabase login:",e)}}return}}catch(e){console.warn("[v0] Error authenticating via Supabase auth:",e)}let i={"dentist@example.com":{id:"7a8c5e19-d3f2-4b7a-8c6f-5e2d9a1b3c47",email:"dentist@example.com",name:"Dr. Sarah Dentist",role:"dentist",specialization:"General Dentistry"},"hr@example.com":{id:"9b2d1f8a-6c3e-4d9a-8b5f-7e2c1a3d6b9e",email:"hr@example.com",name:"Admin HR",role:"hr"},"sarah.smith@dental.com":{id:"a2b6f9aa-c1db-4126-91ea-e68ce0764cf7",email:"sarah.smith@dental.com",name:"Dr. Sarah Smith",role:"dentist",specialization:"General Dentistry"},"john.doe@dental.com":{id:"36bbff44-0df3-4926-a241-83e753324ffa",email:"john.doe@dental.com",name:"Dr. John Doe",role:"dentist",specialization:"Orthodontics"},"emily.johnson@dental.com":{id:"63d250c7-d355-4eaa-b99e-d502b7db5dfb",email:"emily.johnson@dental.com",name:"Dr. Emily Johnson",role:"dentist",specialization:"Periodontics"},"michael.chen@dental.com":{id:"eab4dac1-1534-4b6d-80d1-243273ee4773",email:"michael.chen@dental.com",name:"Dr. Michael Chen",role:"dentist",specialization:"Prosthodontics"},"lisa.anderson@dental.com":{id:"8e87c140-0749-4fe1-9713-39b05df2f566",email:"lisa.anderson@dental.com",name:"Dr. Lisa Anderson",role:"dentist",specialization:"Endodontics"}}[a];if(i){l(i),localStorage.setItem("user",JSON.stringify(i));return}throw Error("Invalid credentials")},g=async(e,a,t,i)=>{let n=(0,r.getSupabaseClient)(),{data:o,error:s}=await n.from("auth_users").select("*").eq("email",e).maybeSingle();if(s)throw console.error("[v0] Error checking existing auth user:",s),Error("Registration failed");if(o)return{status:"exists",user:o};try{let{data:r,error:o}=await n.from("auth_users").insert([{email:e,password_hash:a,name:t,role:"patient",phone:i||null}]).select().single();if(o||!r)throw console.error("[v0] Error creating auth user:",o),Error("Registration failed");let{data:s,error:c}=await n.from("patients").insert([{user_id:r.id,name:t,email:e,phone:i||null}]).select().single();c&&console.warn("[v0] Warning creating patient row:",c);let d={id:r.id,email:r.email,name:r.name||t,role:"patient",phone:r.phone||i||void 0};return l(d),localStorage.setItem("user",JSON.stringify(d)),u(!1),{status:"created",user:d}}catch(e){throw console.error("[v0] Registration error:",e instanceof Error?e.message:String(e)),e}},f=async(a,t)=>{try{if(!o||"patient"!==o.role)throw Error("Only patients can register");let{patientService:i}=await e.A(44514);if(await i.getByName(a))throw Error(`Patient with name '${a}' already exists. Please use a different name.`);let n=await i.create({name:a,email:o.email,phone:t||null,dob:null,gender:null,address:null});try{let e=(0,r.getSupabaseClient)(),{data:i,error:n}=await e.from("auth_users").select("*").eq("email",o.email).maybeSingle();if(n&&console.warn("[v0] Warning checking auth_users:",n),!i){let{error:r}=await e.from("auth_users").insert([{email:o.email,name:a,role:"patient",phone:t||null}]);r&&console.warn("[v0] Warning inserting auth_users record:",r)}}catch(e){console.warn("[v0] Warning ensuring auth_users record:",e)}if(n){let e={...o,name:a,phone:t};l(e),localStorage.setItem("user",JSON.stringify(e)),u(!1)}}catch(e){throw console.error("[v0] Error saving patient profile:",e instanceof Error?e.message:String(e)),e}};return(0,a.jsx)(i.Provider,{value:{user:o,loading:s,login:p,register:g,logout:()=>{l(null),localStorage.removeItem("user"),(0,r.getSupabaseClient)().auth.signOut()},isAuthenticated:!!o,showPatientRegistration:d,savePatientProfile:f},children:n})}function o(){let e=(0,t.useContext)(i);if(void 0===e)throw Error("useAuth must be used within AuthProvider");return e}e.s(["AuthProvider",()=>n,"useAuth",()=>o])},44514,e=>{e.v(a=>Promise.all(["static/chunks/fca72dabca83a75e.js"].map(a=>e.l(a))).then(()=>a(27890)))}]);