module.exports=[35924,a=>{"use strict";a.i(61153);let b=()=>{throw Error("Database service can only be used in client-side code")};a.s(["appointmentService",0,{async getAll(){try{let{data:a,error:c}=await b().from("appointments").select("*, patients(name, email), dentists(name)").order("date",{ascending:!1});if(c)throw console.error("[v0] Supabase error fetching all appointments:",c),Error(`Failed to fetch appointments: ${c.message}`);return a}catch(a){throw console.error("[v0] Error in appointmentService.getAll():",a instanceof Error?a.message:JSON.stringify(a)),a}},async getByPatientId(a){try{let{data:c,error:d}=await b().from("appointments").select("*, patients(name), dentists(name)").eq("patient_id",a).order("date",{ascending:!1});if(d)throw console.error("[v0] Supabase error fetching patient appointments:",d),Error(`Failed to fetch patient appointments: ${d.message}`);return c}catch(a){throw console.error("[v0] Error in appointmentService.getByPatientId():",a instanceof Error?a.message:JSON.stringify(a)),a}},async getByDentistId(a){try{let{data:c,error:d}=await b().from("appointments").select("*, patients(name, email), dentists(name)").eq("dentist_id",a).order("date",{ascending:!1});if(d)throw console.error("[v0] Supabase error fetching dentist appointments:",d),Error(`Failed to fetch dentist appointments: ${d.message}`);return c}catch(a){throw console.error("[v0] Error in appointmentService.getByDentistId():",a instanceof Error?a.message:JSON.stringify(a)),a}},async create(a){try{let{data:c,error:d}=await b().from("appointments").insert([a]).select("*, patients(name), dentists(name)").single();if(d)throw console.error("[v0] Supabase error creating appointment:",d),Error(`Failed to create appointment: ${d.message}`);return c}catch(a){throw console.error("[v0] Error in appointmentService.create():",a instanceof Error?a.message:JSON.stringify(a)),a}},async update(a,c){try{let{data:d,error:e}=await b().from("appointments").update({...c,updated_at:new Date}).eq("id",a).select("*, patients(name), dentists(name)").single();if(e)throw console.error("[v0] Supabase error updating appointment:",e),Error(`Failed to update appointment: ${e.message}`);return d}catch(a){throw console.error("[v0] Error in appointmentService.update():",a instanceof Error?a.message:JSON.stringify(a)),a}},async delete(a){try{let{error:c}=await b().from("appointments").delete().eq("id",a);if(c)throw console.error("[v0] Supabase error deleting appointment:",c),Error(`Failed to delete appointment: ${c.message}`)}catch(a){throw console.error("[v0] Error in appointmentService.delete():",a instanceof Error?a.message:JSON.stringify(a)),a}},async changeStatus(a,b){return this.update(a,{status:b})}},"dentistService",0,{async getAll(){let{data:a,error:c}=await b().from("dentists").select("*").order("name",{ascending:!0});if(c)throw console.error("Supabase error fetching dentists:",c),Error(`Failed to fetch dentists: ${c.message}`);return a},async getById(a){let{data:c,error:d}=await b().from("dentists").select("*").eq("id",a).single();if(d)throw d;return c},async create(a){let{data:c,error:d}=await b().from("dentists").insert([a]).select().single();if(d)throw console.error("Supabase error creating dentist:",d),Error(`Failed to create dentist: ${d.message}`);return c},async update(a,c){let{data:d,error:e}=await b().from("dentists").update({...c,updated_at:new Date}).eq("id",a).select().single();if(e)throw e;return d},async delete(a){let{error:c}=await b().from("dentists").delete().eq("id",a);if(c)throw c}},"inventoryService",0,{async getAll(){let{data:a,error:c}=await b().from("inventory").select("*").order("status",{ascending:!1});if(c)throw c;return a},async getById(a){let{data:c,error:d}=await b().from("inventory").select("*").eq("id",a).single();if(d)throw d;return c},async create(a){try{let c,d=b();try{let a=await d.auth.getSession();c=a?.data?.session?.access_token||a?.data?.access_token}catch(a){}let e={"Content-Type":"application/json"};c&&(e.Authorization=`Bearer ${c}`);let f=await fetch("/api/inventory/create",{method:"POST",headers:e,body:JSON.stringify(a)}),g=await f.json();if(!f.ok){let a=g?.error||`Status ${f.status}`;throw console.error("[v0] Inventory create API error:",a),Error(a)}return g}catch(b){let a=b instanceof Error?b.message:JSON.stringify(b);throw console.error("[v0] Failed to call inventory create API:",a),Error(a)}},async update(a,c){let d=(a=>{if(!a||"object"!=typeof a||Array.isArray(a))return a;let b={};return Object.entries(a).forEach(([a,c])=>{b[a.replace(/[A-Z]/g,a=>`_${a.toLowerCase()}`)]=c}),b})(c),{data:e,error:f}=await b().from("inventory").update({...d,updated_at:new Date}).eq("id",a).select().single();if(f)throw f;return e},async delete(a){let{error:c}=await b().from("inventory").delete().eq("id",a);if(c)throw c},async getLowStock(){let{data:a,error:c}=await b().from("inventory").select("*").or("status.eq.low,status.eq.critical");if(c)throw c;return a}},"patientService",0,{async getAll(){let{data:a,error:c}=await b().from("patients").select("*").order("created_at",{ascending:!1});if(c)throw console.error("Supabase error fetching patients:",c),Error(`Failed to fetch patients: ${c.message}`);return a},async getById(a){let{data:c,error:d}=await b().from("patients").select("*").eq("id",a).single();if(d)throw d;return c},async getByName(a){try{let{data:c,error:d}=await b().from("patients").select("*").ilike("name",a).limit(1);if(d)throw console.error("[v0] Supabase error fetching patient by name:",d),Error(`Failed to fetch patient by name: ${d.message}`);return c&&c.length>0?c[0]:null}catch(a){throw console.error("[v0] Error in patientService.getByName():",a instanceof Error?a.message:JSON.stringify(a)),a}},async getByEmail(a){try{let{data:c,error:d}=await b().from("patients").select("*").eq("email",a).limit(1);if(d)throw console.error("[v0] Supabase error fetching patient by email:",d),Error(`Failed to fetch patient by email: ${d.message}`);return c&&c.length>0?c[0]:null}catch(a){throw console.error("[v0] Error in patientService.getByEmail():",a instanceof Error?a.message:JSON.stringify(a)),a}},async create(a){let{data:c,error:d}=await b().from("patients").insert([a]).select().single();if(d)throw console.error("Supabase error creating patient:",d),Error(`Failed to create patient: ${d.message}`);return c},async update(a,c){let{data:d,error:e}=await b().from("patients").update({...c,updated_at:new Date}).eq("id",a).select().single();if(e)throw e;return d},async delete(a){let{error:c}=await b().from("patients").delete().eq("id",a);if(c)throw c}},"paymentService",0,{async getAll(){let{data:a,error:c}=await b().from("payments").select("*, patients(name, email), dentists(name)").order("date",{ascending:!1});if(c)throw c;return a},async getByPatientId(a){try{let{data:c,error:d}=await b().from("payments").select("*, dentists(name)").eq("patient_id",a).order("date",{ascending:!1});if(d)return console.warn("Error fetching patient payments:",d.message),[];return c||[]}catch(a){return console.warn("Exception fetching patient payments:",a instanceof Error?a.message:a),[]}},async getByDentistId(a){try{let{data:c,error:d}=await b().from("payments").select("*, patients(name, email)").eq("dentist_id",a).order("date",{ascending:!1});if(d)return console.warn("Error fetching dentist payments:",d.message),[];return c||[]}catch(a){return console.warn("Exception fetching dentist payments:",a instanceof Error?a.message:a),[]}},async create(a){let{data:c,error:d}=await b().from("payments").insert([a]).select("*, patients(name), dentists(name)").single();if(d)throw d;return c},async update(a,c){let{data:d,error:e}=await b().from("payments").update({...c,updated_at:new Date}).eq("id",a).select("*, patients(name), dentists(name)").single();if(e)throw e;return d},async delete(a){let{error:c}=await b().from("payments").delete().eq("id",a);if(c)throw c},async getPatientBalance(a){try{let{data:c,error:d}=await b().from("payments").select("amount, status").eq("patient_id",a);if(d)return console.warn("Error fetching patient balance:",d.message),{totalBalance:0,totalPaid:0,total:0};let e=0,f=0;return c?.forEach(a=>{"paid"===a.status?f+=a.amount:"unpaid"===a.status?e+=a.amount:"partial"===a.status&&(e+=a.amount)}),{totalBalance:e,totalPaid:f,total:e+f}}catch(a){return console.warn("Exception fetching patient balance:",a instanceof Error?a.message:a),{totalBalance:0,totalPaid:0,total:0}}},async getDentistEarnings(a){try{let{data:c,error:d}=await b().from("payments").select("amount, status, appointment_id, appointments(status)").eq("dentist_id",a);if(d)return console.warn("Error fetching dentist earnings:",d.message),{totalEarned:0,totalPending:0,totalCompleted:0,count:0};let e=0,f=0,g=0;return c?.forEach(a=>{let b=a.appointments?.status;"completed"===b?(e+=a.amount,g+=1):"confirmed"===b?f+=a.amount:"paid"===a.status?(e+=a.amount,g+=1):"unpaid"===a.status?f+=a.amount:"partial"===a.status&&(e+=a.amount)}),{totalEarned:e,totalPending:f,totalCompleted:g,count:c?.length||0}}catch(a){return console.warn("Exception fetching dentist earnings:",a instanceof Error?a.message:a),{totalEarned:0,totalPending:0,totalCompleted:0,count:0}}}},"supplyRequestService",0,{async getAll(){let{data:a,error:c}=await b().from("supply_requests").select("*, inventory(name, category), staff(name)").order("requested_date",{ascending:!1});if(c)throw c;if(a&&a.length>0&&a[0].dentist_id)try{let c=[...new Set(a.map(a=>a.dentist_id).filter(Boolean))],{data:d}=await b().from("dentists").select("id, name").in("id",c),e=Object.fromEntries(d?.map(a=>[a.id,a])||[]);return a.map(a=>({...a,dentists:a.dentist_id?e[a.dentist_id]:null}))}catch(a){console.warn("[v0] Could not fetch dentist info:",a)}return a},async getPending(){let{data:a,error:c}=await b().from("supply_requests").select("*, inventory(name, category), staff(name)").eq("status","pending");if(c)throw c;if(a&&a.length>0&&a[0].dentist_id)try{let c=[...new Set(a.map(a=>a.dentist_id).filter(Boolean))],{data:d}=await b().from("dentists").select("id, name").in("id",c),e=Object.fromEntries(d?.map(a=>[a.id,a])||[]);return a.map(a=>({...a,dentists:a.dentist_id?e[a.dentist_id]:null}))}catch(a){console.warn("[v0] Could not fetch dentist info:",a)}return a},async create(a){try{let{data:c,error:d}=await b().from("supply_requests").insert([a]).select("*, inventory(name, category), staff(name)").single();if(d)throw console.error("[v0] Supabase error creating supply request:",d),Error(`Failed to create supply request: ${d.message}`);if(c&&c.dentist_id)try{let{data:a}=await b().from("dentists").select("id, name").eq("id",c.dentist_id).single();a&&(c.dentists=a)}catch(a){console.warn("[v0] Could not fetch dentist info:",a)}return c}catch(a){throw console.error("[v0] Exception in supplyRequestService.create:",a),a}},async update(a,c){let{data:d,error:e}=await b().from("supply_requests").update({...c,updated_at:new Date}).eq("id",a).select().single();if(e)throw e;return d}},"treatmentRecordService",0,{async getByPatientId(a){let{data:c,error:d}=await b().from("treatment_records").select("*, treatments(name, category), dentists(name)").eq("patient_id",a).order("date",{ascending:!1});if(d)throw d;return c},async create(a){let{data:c,error:d}=await b().from("treatment_records").insert([a]).select("*, treatments(name), dentists(name)").single();if(d)throw d;return c}},"treatmentService",0,{async getAll(){let{data:a,error:c}=await b().from("treatments").select("*").order("category",{ascending:!0});if(c)throw c;return a},async getById(a){let{data:c,error:d}=await b().from("treatments").select("*").eq("id",a).single();if(d)throw d;return c},async create(a){let{data:c,error:d}=await b().from("treatments").insert([a]).select().single();if(d)throw d;return c},async update(a,c){let{data:d,error:e}=await b().from("treatments").update({...c,updated_at:new Date}).eq("id",a).select().single();if(e)throw e;return d},async delete(a){let{error:c}=await b().from("treatments").delete().eq("id",a);if(c)throw c}}])}];

//# sourceMappingURL=im_mouthworks_im_mouthworks_lib_db-service_ts_a8d2ef56._.js.map